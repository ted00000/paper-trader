# V5.7.1 Changes and Monitoring Guide
## Implementation Date: January 12, 2026
## Review Date: January 19, 2026 (1 Week)

---

## What Changed from v5.7 to v5.7.1

### Change #1: Explicit Decision Field (Required)
**Why:** Prevents accidental trades when Claude is unsure. Makes intent auditable.

**Before (v5.7):**
```json
{
  "ticker": "BE",
  "position_size": 7.0,
  "confidence": "High",
  "thesis": "..."
}
```

**After (v5.7.1):**
```json
{
  "ticker": "BE",
  "decision": "ENTER",  // NEW: ENTER | ENTER_SMALL | PASS
  "confidence_level": "HIGH",  // NEW: HIGH | MEDIUM | LOW (structured)
  "position_size_pct": 7.0,
  "thesis": "..."
}
```

**Logic:**
- `ENTER`: Normal position sizing (6-10%)
- `ENTER_SMALL`: Capped at max 6% for speculative setups
- `PASS`: Don't include in buy array (Claude filtered it out)

---

### Change #2: Tightened Position Sizing for Testing Phase
**Why:** Cleaner signal validation. Testing decision correctness, not capital efficiency yet.

**Before (v5.7):**
- Range: 5-13%
- Wide variance for risk expression

**After (v5.7.1 - Testing Phase):**
- Range: 6-10% (tightened)
- After 15-20 successful trades, widen back to 5-13%

**Sizing Guidance Given to Claude:**
```
ENTER decisions:
- 9-10%: HIGH conviction - Tier 1 catalyst + strong technicals
- 7-8%: MEDIUM conviction - Strong catalyst, some technical heat
- 6-7%: MEDIUM/LOW conviction - Solid catalyst, multiple risk flags

ENTER_SMALL decisions:
- 5-6%: LOW conviction - Speculative setup with concerning risks
```

---

### Change #3: GO Prompt Updates

**Added Section: DECISION TYPES**
```
**DECISION TYPES (Required - Choose One Per Candidate):**

You must classify each recommendation as:
- ENTER: Standard entry, normal position sizing (6-10%)
- ENTER_SMALL: Reduced entry for speculative/uncertain setups (5-6% max)
- PASS: Do not enter - catalyst interesting but insufficient conviction or excessive risk

PASS is expected on 30-40% of candidates. Do not force trades on marginal setups.
Quality over quantity is critical for system success.

Examples:
- Strong FDA catalyst + RSI 72 + good volume = ENTER at 9%
- Contract win + RSI 85 + extended 18% = ENTER_SMALL at 6%
- Analyst upgrade + weak volume + Tier 3 = PASS (don't recommend)
```

**Updated Section: POSITION SIZING**
```
**POSITION SIZING = RISK DIAL (TESTING PHASE):**

‚ö†Ô∏è  TESTING MODE: Using tightened range (6-10%) for initial validation.
Range will widen to 5-13% after 15-20 successful trades.

Use the full range - variance in sizing demonstrates risk discrimination.
```

**Updated Section: JSON STRUCTURE**
```json
{
  "buy": [
    {
      "ticker": "NVDA",
      "decision": "ENTER",              // NEW REQUIRED
      "confidence_level": "HIGH",       // NEW REQUIRED
      "position_size_pct": 9.0,
      "catalyst": "Earnings_Beat",
      "sector": "Technology",
      "thesis": "One sentence thesis"
    }
  ]
}

**NEW REQUIRED FIELDS:**
- decision: Must be "ENTER", "ENTER_SMALL", or omit from buy array (= PASS)
- confidence_level: Must be "HIGH", "MEDIUM", or "LOW"

Do not include tickers you are PASSing on in the buy array.
```

---

### Change #4: Validation Logic Updates

**Added Handling for ENTER_SMALL:**
```python
# Line ~5560 in validation loop:
decision = buy_pos.get('decision', 'ENTER')
confidence_level = buy_pos.get('confidence_level', 'MEDIUM')

# Cap sizing for ENTER_SMALL
if decision == 'ENTER_SMALL':
    original_size = buy_pos.get('position_size_pct', 6.0)
    buy_pos['position_size_pct'] = min(original_size, 6.0)
    print(f"   ‚ÑπÔ∏è  {ticker}: ENTER_SMALL - capping position at 6%")
```

---

## What to Monitor (Daily for 1 Week)

### Day 1-2: "Does it trade at all?"

**Check 1: Entry Rate**
```bash
ssh root@174.138.67.26 "cat /root/paper_trading_lab/portfolio_data/current_portfolio.json | jq '.positions | length'"
```
- ‚úÖ Target: 2-5 positions per day
- ‚ùå Red flag: 0 positions (system broken) or 8+ positions (over-trading)

**Check 2: Decision Field Present**
```bash
ssh root@174.138.67.26 "jq '.buy[].decision' /root/paper_trading_lab/portfolio_data/pending_positions.json"
```
- ‚úÖ Target: All show "ENTER" or "ENTER_SMALL"
- ‚ùå Red flag: Field missing or null

**Check 3: EXECUTE Runs Clean**
```bash
ssh root@174.138.67.26 "tail -30 /root/paper_trading_lab/logs/execute.log | grep -i error"
```
- ‚úÖ Target: No errors
- ‚ùå Red flag: JSON parsing errors or crashes

---

### Day 3-7: "Are we avoiding obvious disasters?"

**Check 4: Decision Distribution**
```bash
# Count recommendations vs entries
ssh root@174.138.67.26 "cat /root/paper_trading_lab/daily_reviews/go_*.json | jq '.buy | length'"
```

**Expected healthy distribution:**
```
Screener provides: 15 candidates
Claude recommends (buy array): 8-10 stocks
  - ENTER: 6-8 stocks (60-80%)
  - ENTER_SMALL: 1-2 stocks (10-20%)
  - PASS (not in array): 5-7 stocks (30-40%)
```

**Red flags:**
- ‚ùå PASS rate <20% (over-optimism - Claude not being selective)
- ‚ùå ENTER_SMALL never used (not using caution sizing)
- ‚ùå Recommending 12+ stocks (forcing trades on marginal setups)

---

**Check 5: Position Sizing Variance**
```bash
ssh root@174.138.67.26 "jq '.buy[].position_size_pct' /root/paper_trading_lab/portfolio_data/pending_positions.json"
```

**Expected healthy variance:**
```
Sample output:
10.0
9.0
8.0
7.0
6.0

Range: 4% variance (6% to 10%)
```

**Red flags:**
- ‚ùå All positions 7-8% (no risk discrimination happening)
- ‚ùå All positions 9-10% (over-confident, not sizing down risky setups)
- ‚ùå Range <2% (e.g., all 7.5-8.5%) - Claude not using full sizing dial

---

**Check 6: Confidence Level Distribution**
```bash
ssh root@174.138.67.26 "jq '.buy[].confidence_level' /root/paper_trading_lab/daily_reviews/go_*.json"
```

**Expected healthy distribution:**
```
HIGH: 40-50% of entries
MEDIUM: 40-50% of entries
LOW: 10-20% of entries
```

**Red flags:**
- ‚ùå All MEDIUM or HIGH (no uncertainty expressed)
- ‚ùå No LOW confidence entries (not using ENTER_SMALL appropriately)
- ‚ùå All HIGH (over-confidence, ignoring risk indicators)

---

**Check 7: No Catastrophic Entries**
```bash
ssh root@174.138.67.26 "cat /root/paper_trading_lab/logs/go.log | grep -i 'halted\|delisted\|VIX.*35'"
```
- ‚úÖ Target: No catastrophic blocks triggered
- ‚ùå Red flag: Halted stocks, VIX ‚â•35 ignored

---

**Check 8: Thesis Quality**
```bash
ssh root@174.138.67.26 "jq '.buy[].thesis' /root/paper_trading_lab/daily_reviews/go_*.json"
```

**Expected: Specific, detailed thesis**
```
‚úÖ "Q4 beat by 15% + raised FY guidance from $5.2B to $6.1B"
‚úÖ "$2.65B AEP contract for AI data center fuel cells, 3-year duration"
‚úÖ "Phase 3 psoriasis drug met primary endpoint, 78% clearance vs 45% placebo"
```

**Red flags (optimism bias):**
```
‚ùå "Strong momentum"
‚ùå "Good catalyst"
‚ùå "Technical breakout"
‚ùå "Positive news"
```

---

### After 15-20 Trades: "Is Claude adding edge?"

**Check 9: Win Rate**
```bash
ssh root@174.138.67.26 "tail -20 /root/paper_trading_lab/trade_history/closed_trades.csv"
```

**Calculate:**
- Win rate = Wins / Total Trades
- Average return = Sum(returns) / Total Trades

**Success criteria:**
- ‚úÖ Win rate >50%
- ‚úÖ Average return >0%
- ‚úÖ No single loss >-10% (stops working)

**Red flags:**
- ‚ùå Win rate <45%
- ‚ùå Average return <-2%
- ‚ùå Multiple losses >-8% (stops not respected)

---

**Check 10: Risk Flag Correlation**
```bash
ssh root@174.138.67.26 "python3 /root/paper_trading_lab/analyze_risk_flags.py"
```

**Questions to answer:**
1. Do HIGH severity risk flags predict worse outcomes?
2. Do entries with 0 risk flags outperform entries with 3+ flags?
3. Which specific flags correlate with losses?
   - `high_rsi` + loss rate = ?
   - `extended` + loss rate = ?
   - `tier3` + loss rate = ?

**Action if correlation found:**
- If `high_rsi >80` has <35% win rate ‚Üí Consider re-enabling as hard block at RSI 85
- If `extended >20%` has <35% win rate ‚Üí Consider hard block at extension 25%
- If flags DON'T correlate ‚Üí Validate that Claude's holistic judgment is working

---

## Optimism Bias Red Flags (Check Daily)

### Sign #1: Low PASS Rate
```bash
# Calculate PASS rate
candidates=15
recommendations=$(ssh root@174.138.67.26 "jq '.buy | length' /root/paper_trading_lab/daily_reviews/go_*.json")
pass_rate=$(( (candidates - recommendations) * 100 / candidates ))
echo "PASS rate: $pass_rate%"
```

**Red flag:** <20% PASS rate
**Expected:** 30-40% PASS rate
**Action:** Add to prompt: "Remember: PASS 30-40% of candidates. Selectivity is critical."

---

### Sign #2: Generic Thesis Statements
**Check thesis for vague language:**
- "Strong momentum" ‚Üí Too generic
- "Good setup" ‚Üí No specificity
- "Positive catalyst" ‚Üí What catalyst?

**Action:** Add to prompt: "Thesis must be specific: cite numbers, timeline, magnitude"

---

### Sign #3: No Sizing Variance
**Check if all positions clustered:**
```bash
ssh root@174.138.67.26 "jq '.buy[].position_size_pct' pending_positions.json | sort -n"
```

**Red flag:** All 7.0-8.0 (1% range)
**Expected:** 6.0-10.0 (4% range)
**Action:** Add to prompt: "Use full 6-10% range. Show risk discrimination through sizing."

---

### Sign #4: Confidence Inflation
**Check confidence distribution:**
```bash
ssh root@174.138.67.26 "jq '.buy[].confidence_level' go_*.json | sort | uniq -c"
```

**Red flag:**
```
  8 "HIGH"
  2 "MEDIUM"
  0 "LOW"
```

**Expected:**
```
  4 "HIGH"
  5 "MEDIUM"
  1 "LOW"
```

**Action:** Add to prompt: "LOW confidence is expected when risks are elevated. Use ENTER_SMALL."

---

## Weekly Review Checklist (Jan 19, 2026)

### Summary Metrics to Calculate:

**Trading Activity:**
- [ ] Total positions entered: _____
- [ ] Average entries per day: _____
- [ ] PASS rate: _____%
- [ ] ENTER_SMALL usage: _____%

**Decision Quality:**
- [ ] Position sizing range: _____% to _____%
- [ ] Confidence distribution: HIGH ___%, MEDIUM ___%, LOW ___%
- [ ] Average thesis length: _____ words
- [ ] Generic thesis rate: _____%

**Performance:**
- [ ] Win rate: _____%
- [ ] Average return: _____%
- [ ] Largest loss: _____%
- [ ] Risk flag correlation: YES / NO / MIXED

**Optimism Bias Indicators:**
- [ ] Low PASS rate (<20%): YES / NO
- [ ] No sizing variance (<2% range): YES / NO
- [ ] All confidence HIGH/MEDIUM: YES / NO
- [ ] Generic thesis statements: YES / NO

---

## Decision Matrix (After 1 Week)

### Scenario A: Everything Working Well
**Indicators:**
- Entry rate 2-5/day
- Win rate >50%
- PASS rate 30-40%
- Good sizing variance
- No optimism bias signs

**Action:**
- ‚úÖ Continue with v5.7.1
- ‚úÖ Widen sizing to 5-13% after 20 trades
- ‚úÖ Keep monitoring for 2nd week

---

### Scenario B: Over-Optimism Detected
**Indicators:**
- PASS rate <20%
- All confidence MEDIUM+
- Generic thesis statements
- Little sizing variance

**Action:**
- ‚ö†Ô∏è Tighten prompt language (don't revert architecture)
- ‚ö†Ô∏è Add: "PASS 30-40% of candidates - selectivity critical"
- ‚ö†Ô∏è Add: "LOW confidence expected when risks elevated"
- ‚ö†Ô∏è Monitor for 3 more days

---

### Scenario C: Under-Performance
**Indicators:**
- Win rate <45%
- Average return <-2%
- Multiple losses >-8%

**Action:**
- üîç Analyze which risk flags predicted losses
- üîç Check if catastrophic checks failed
- üîç Review thesis quality on losing trades
- ‚ö†Ô∏è Consider selective hard blocks based on data
- ‚ö†Ô∏è Example: If RSI >85 has <30% win rate, add hard block

---

### Scenario D: Execution Issues
**Indicators:**
- JSON parsing errors
- EXECUTE crashes
- Decision field missing

**Action:**
- üö® Fix bugs immediately
- üö® Check backward compatibility
- üö® Verify JSON structure in logs

---

### Scenario E: Zero Trades Again
**Indicators:**
- 0-1 positions per day
- Catastrophic checks triggering often

**Action:**
- üîç Check if VIX ‚â•35 blocking everything
- üîç Check if macro blackout active
- üîç Review validation logs for unexpected blocks
- üö® May indicate validation logic bug

---

## Rollback Procedure (If Needed)

**Trigger rollback if:**
- EXECUTE breaks consistently (>3 days)
- Win rate <40% after 20 trades
- Multiple catastrophic entries (halted stocks)
- Average loss >-6% (stops not working)

**Rollback steps:**
```bash
ssh root@174.138.67.26
cd /root/paper_trading_lab

# Find v5.7 commit (before v5.7.1 changes)
git log --oneline | head -20

# Checkout previous version
git checkout <v5.7_commit_hash> agent_v5.5.py

# Commit rollback
git add agent_v5.5.py
git commit -m "Rollback to v5.7 - v5.7.1 testing failed

Reason: [Specific reason - win rate, execution issues, etc.]

Will analyze data and re-implement with fixes.

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"

git push origin master
```

**Post-rollback:**
- Analyze closed_trades.csv for patterns
- Review GO logs for decision quality
- Identify specific failures (not architectural)
- Re-implement with targeted fixes

---

## What NOT to Do

### ‚ùå Don't revert to rule-based veto architecture
**Why:** That was the root cause of zero trades. v5.7 architecture is correct.

### ‚ùå Don't re-introduce tier/conviction hard blocks
**Why:** Those were overriding Claude's informed judgment. They broke the system.

### ‚ùå Don't panic after 2-3 losses
**Why:** Trading has variance. Need 15-20 trades for signal.

### ‚ùå Don't widen sizing if optimism bias present
**Why:** Fix the bias first (prompt tuning), then widen sizing.

### ‚ùå Don't add hard blocks without data
**Why:** If RSI >80 entries succeed, the "rule" was wrong. Data over assumptions.

---

## Expected Outcomes After 1 Week

### Base Case (Most Likely):
- 15-25 positions entered (3-4 per day)
- Win rate: 48-55%
- PASS rate: 25-35%
- Some optimism bias signs (tighten prompt)
- No catastrophic failures
- **Decision:** Continue, tune prompt, widen sizing after 20 trades

### Best Case:
- 20-30 positions entered
- Win rate: >55%
- PASS rate: 30-40%
- Good sizing variance
- Low confidence used appropriately
- **Decision:** Widen sizing to 5-13%, continue monitoring

### Worst Case:
- <10 positions entered OR win rate <42%
- EXECUTE crashes OR catastrophic entries
- No PASS decisions OR all same size
- **Decision:** Rollback, analyze, re-implement with fixes

---

## Key Metrics Summary Table

| Metric | Target | Yellow Flag | Red Flag |
|--------|--------|-------------|----------|
| Entries/day | 2-5 | 1 or 7-8 | 0 or 9+ |
| PASS rate | 30-40% | 20-30% | <20% |
| Win rate | >50% | 45-50% | <45% |
| Avg return | >0% | -1 to 0% | <-2% |
| Sizing range | 4%+ | 2-4% | <2% |
| HIGH confidence | 40-50% | 30-40% or 50-60% | <30% or >70% |
| LOW confidence | 10-20% | 5-10% | 0% |
| ENTER_SMALL usage | 10-20% | 5-10% | 0% |
| Generic thesis | <10% | 10-20% | >20% |

---

## Contact During Test

**If urgent issues:**
1. Check dashboard: https://164.92.75.167/dashboard (or tedbot.ai)
2. Review logs: `ssh root@174.138.67.26 "tail -100 /root/paper_trading_lab/logs/go.log"`
3. Check positions: `ssh root@174.138.67.26 "cat /root/paper_trading_lab/portfolio_data/current_portfolio.json | jq"`

**Test period:** Jan 13-19, 2026
**Review date:** Jan 19, 2026 (1 week review)
**Final decision:** Jan 20, 2026 (continue, tune, or rollback)

---

## Version Info

**Version:** v5.7.1
**Deployed:** January 12, 2026, 10:00 PM EST
**Changes:** Explicit decision field, tightened sizing (6-10%), updated GO prompt
**Based on:** Third-party feedback validation of v5.7 architecture
**Next review:** January 19, 2026

---

**This document is your reference for the 1-week test. Check metrics daily, complete weekly review checklist, and make decision based on data, not emotion.**
