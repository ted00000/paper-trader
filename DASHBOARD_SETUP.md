# Admin Dashboard Setup Guide

## Overview
Secure web-based admin dashboard for monitoring the trading system and approving parameter adjustments.

## Features
- **Authentication**: Password-protected with rate limiting
- **System Monitoring**: Real-time account value, positions, win rates
- **Action Approvals**: Review and approve/reject parameter recommendations
- **Exclusion Tracking**: Monitor Claude's exclusion overrides
- **Audit Logging**: All security events logged to `logs/dashboard/audit.log`

---

## Initial Setup

### 1. Generate Credentials
```bash
cd /Users/tednunes/Downloads/paper_trading_lab
python3 generate_dashboard_credentials.py
```

This will:
- Prompt you to create an admin password (min 12 characters)
- Generate a secure SECRET_KEY
- Save credentials to `~/.env`

**IMPORTANT**: Keep `~/.env` secure. Never commit to git.

### 2. Install Dependencies
```bash
pip install -r requirements_dashboard.txt
```

### 3. Create Required Directories
These are created automatically on first run, but you can create them manually:
```bash
mkdir -p logs/dashboard
mkdir -p dashboard_data
mkdir -p dashboard/templates
mkdir -p dashboard/static
```

---

## Starting the Dashboard

### Local Development
```bash
./start_dashboard.sh
```

Access at: `http://localhost:5000`

### Remote Access (SSH Tunnel)
**Recommended for production use**

From your local machine:
```bash
ssh -L 5000:localhost:5000 user@your-server
```

Then access `http://localhost:5000` in your browser.

### Direct Network Access (NOT RECOMMENDED)
Only use this on a trusted private network. The dashboard is configured for HTTP, not HTTPS.

---

## Security Best Practices

### 1. Use Strong Passwords
- Minimum 12 characters
- Mix of uppercase, lowercase, numbers, symbols
- Change periodically

### 2. Monitor Audit Logs
```bash
tail -f logs/dashboard/audit.log
```

Events logged:
- `LOGIN_SUCCESS` - Successful authentication
- `LOGIN_FAILED` - Failed login attempt
- `LOGIN_RATE_LIMITED` - IP blocked due to too many attempts
- `APPROVE_ACTION` - Parameter change approved
- `REJECT_ACTION` - Parameter change rejected
- `LOGOUT` - User logged out

### 3. Rate Limiting
- Max 5 failed login attempts per IP
- 15-minute lockout after threshold exceeded
- Automatic cleanup of old attempts

### 4. Session Security
- Sessions expire after 2 hours of inactivity
- Cookies are HTTP-only (prevents XSS)
- CSRF protection recommended for production

### 5. Enable HTTPS in Production
Edit `dashboard_server.py`:
```python
app.config['SESSION_COOKIE_SECURE'] = True  # Requires HTTPS
```

Then use a reverse proxy (nginx/Apache) with SSL certificate.

---

## Dashboard Data Flow

### Parameter Recommendations
Generated by `learn_monthly.py`:
1. Analyzes 30+ days of trade data
2. Identifies underperforming parameters (VIX, RS, News Score)
3. Generates recommendations with confidence levels
4. Saves to `dashboard_data/pending_actions.json`

### Exclusion Overrides
Logged by `agent_v5.5.py`:
1. Claude encounters excluded catalyst
2. Provides override reasoning if warranted
3. Trade proceeds if reasoning is valid
4. Override logged to `logs/exclusion_overrides.log`
5. Dashboard shows override results (WIN/LOSS)

---

## File Structure

```
paper_trading_lab/
├── dashboard_server.py          # Flask application
├── start_dashboard.sh           # Startup script
├── generate_dashboard_credentials.py
├── dashboard/
│   ├── templates/
│   │   ├── login.html          # Login page
│   │   └── dashboard.html      # Main dashboard
│   └── static/                 # (future: CSS, JS)
├── dashboard_data/
│   └── pending_actions.json    # Parameter recommendations
├── logs/
│   ├── dashboard/
│   │   └── audit.log          # Security events
│   └── exclusion_overrides.log # Claude overrides
└── ~/.env                      # Credentials (NOT in git)
```

---

## Troubleshooting

### Port Already in Use
```bash
# Find process using port 5000
lsof -i :5000

# Kill it
kill -9 <PID>
```

### Can't Access Dashboard
1. Check server is running: `ps aux | grep dashboard_server`
2. Verify port 5000 is open: `netstat -an | grep 5000`
3. Check firewall rules
4. Use SSH tunnel for remote access

### Forgot Password
```bash
# Regenerate credentials
python3 generate_dashboard_credentials.py

# Restart dashboard
./start_dashboard.sh
```

### Session Timeout
Default: 2 hours. Edit `dashboard_server.py`:
```python
app.config['PERMANENT_SESSION_LIFETIME'] = timedelta(hours=4)
```

---

## API Endpoints

### POST /api/actions/approve
Approve a pending parameter recommendation.

**Request:**
```json
{
  "action_id": "param_vix_20250102_143022",
  "notes": "Data looks good, approved"
}
```

**Response:**
```json
{
  "success": true,
  "action": {
    "status": "APPROVED",
    "approved_by": "admin",
    "code_to_apply": "# In agent_v5.5.py, update VIX threshold\nVIX_THRESHOLD = 22"
  }
}
```

### POST /api/actions/reject
Reject a pending parameter recommendation.

**Request:**
```json
{
  "action_id": "param_vix_20250102_143022",
  "reason": "Sample size too small, need more data"
}
```

**Response:**
```json
{
  "success": true
}
```

---

## Automation (Optional)

### Start Dashboard on Boot (systemd)
Create `/etc/systemd/system/trading-dashboard.service`:
```ini
[Unit]
Description=Trading Dashboard
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/Users/tednunes/Downloads/paper_trading_lab
ExecStart=/Users/tednunes/Downloads/paper_trading_lab/start_dashboard.sh
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

Enable:
```bash
sudo systemctl enable trading-dashboard
sudo systemctl start trading-dashboard
```

---

## Support

**Issues**: Check logs in `logs/dashboard/audit.log`
**Updates**: Pull latest code, restart dashboard
**Security**: Monitor audit log for suspicious activity

---

## Version History
- **v1.0** (2025-01-02): Initial release
  - Password authentication
  - Parameter approval workflow
  - Exclusion override monitoring
